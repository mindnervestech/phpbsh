(function(){var t;t=jQuery;var o=function(o,r,s){o.options.drillDownHandler&&t(s).addClass("pvtValDrillDown").on("click","td.pvtVal,td.pvtTotal",function(){var s=t(this).attr("class").split(" "),n=-1,a=-1;if(t.inArray("pvtVal",s)>=0&&t.each(s,function(){0==this.indexOf("row")&&(a=parseInt(this.substring(3))),0==this.indexOf("col")&&(n=parseInt(this.substring(3)))}),t.inArray("rowTotal",s)>=0){var e=t(this).attr("data-for");a=parseInt(e.substring(3))}if(t.inArray("colTotal",s)>=0){var e=t(this).attr("data-for");n=parseInt(e.substring(3))}var i={};if(n>=0)for(var l=0;l<r.colAttrs.length;l++){var c=r.getColKeys(),v=c[n];i[r.colAttrs[l]]=v[l]}if(a>=0)for(var u=0;u<r.rowAttrs.length;u++){var d=r.getRowKeys(),p=d[a];i[r.rowAttrs[u]]=p[u]}o.options.drillDownHandler(i)})},r=function(o,r,s){var n,a,e,i,l=[];o.sorted=!1;var c=o.getRowKeys(),v=o.getColKeys();for(i in c)n=c[i],a=null!=r?v[r]:[],e=o.getAggregator(n,a),l.push({val:e.value(),key:n});for(l.sort(function(o,r){return s*t.pivotUtilities.naturalSort(o.val,r.val)}),o.rowKeys=[],i=0;i<l.length;i++)o.rowKeys.push(l[i].key);o.sorted=!0},s=function(o,r,s){var n,a,e,i,l=[];o.sorted=!1;var c=o.getRowKeys(),v=o.getColKeys();for(i in v)a=v[i],n=null!=r?c[r]:[],e=o.getAggregator(n,a),l.push({val:e.value(),key:a});for(l.sort(function(o,r){return s*t.pivotUtilities.naturalSort(o.val,r.val)}),o.colKeys=[],i=0;i<l.length;i++)o.colKeys.push(l[i].key);o.sorted=!0},n=function(o,n,a,e,i){var l=function(t,o){t.addClass("desc"==o?"pvtSortDesc":"pvtSortAsc")},c=function(o,r,s,e){r.click(function(){var r=t(this),l=r.data("key_index"),c=o[l];r.hasClass("pvtSortAsc")?(e(n,l,-1),a.sort={direction:"desc"},a.sort[s]=c):r.hasClass("pvtSortDesc")?(n.sorted=!1,a.sort=null):(e(n,l,1),a.sort={direction:"asc"},a.sort[s]=c),i()}).each(function(){if(a.sort&&a.sort[s]){var r=t(this),n=o[r.data("key_index")];n.join("_")==a.sort[s].join("_")&&l(r,a.sort.direction)}})},v=function(o,r){var s=0;r.each(function(){var r=t(this),n=t.trim(r.text()),a=o[s];return null!=a&&a.length>0&&a[a.length-1]==n?(r.addClass("pvtSortable").data("key_index",s),void s++):void 0})},u=n.getColKeys();v(u,t(e).find('.pvtColLabel[colspan="1"]')),c(u,t(e).find('.pvtColLabel.pvtSortable[colspan="1"]'),"column_key",r);var d=n.getRowKeys();v(d,t(e).find('.pvtRowLabel[rowspan="1"]')),c(d,t(e).find('.pvtRowLabel.pvtSortable[rowspan="1"]'),"row_key",s),t(e).find("tr:last .pvtTotalLabel").addClass("pvtTotalColSortable").click(function(){var o=t(this);o.hasClass("pvtSortAsc")?(s(n,null,-1),a.sort={direction:"desc",row_totals:!0}):o.hasClass("pvtSortDesc")?(n.sorted=!1,a.sort=null):(s(n,null,1),a.sort={direction:"asc",row_totals:!0}),i()}).each(function(){var o=t(this);a.sort&&a.sort.row_totals&&l(o,a.sort.direction)}),t(e).find("tr:first .pvtTotalLabel").addClass("pvtTotalRowSortable").click(function(){var o=t(this);o.hasClass("pvtSortAsc")?(r(n,null,-1),a.sort={direction:"desc",col_totals:!0}):o.hasClass("pvtSortDesc")?(n.sorted=!1,a.sort=null):(r(n,null,1),a.sort={direction:"asc",col_totals:!0}),i()}).each(function(){var o=t(this);a.sort&&a.sort.col_totals&&l(o,a.sort.direction)})},a=function(t){var o,r,s,n=t.getColKeys(),a=t.getRowKeys(),e=[],i=[],l=[];for(o in a){e[o]=[];for(r in n)s=t.getAggregator(a[o],n[r]),e[o][r]=s.value();l[o]=t.getAggregator(a[o],[]).value()}for(r in n)i[r]=t.getAggregator([],n[r]).value();return{columnKeys:n,columnAttrs:t.colAttrs,rowKeys:a,rowAttrs:t.rowAttrs,matrix:e,totals:{row:i,column:l}}};window.NRecoPivotTableExtensions=function(o){this.options=t.extend(NRecoPivotTableExtensions.defaults,o)},window.NRecoPivotTableExtensions.prototype.sortDataByOpts=function(t,o){if(t.sorted=!1,o&&o.sort){var n="desc"==o.sort.direction?-1:1;if(o.sort.column_key){var a=t.getColKeys(),e=o.sort.column_key.join("_");for(var i in a)e==a[i].join("_")&&r(t,i,n)}else if(o.sort.row_key){var l=t.getRowKeys(),e=o.sort.row_key.join("_");for(var i in l)e==l[i].join("_")&&s(t,i,n)}else o.sort.row_totals?s(t,null,n):o.sort.col_totals&&r(t,null,n)}},window.NRecoPivotTableExtensions.prototype.wrapTableRenderer=function(r){var s=this;return function(a,e){var i,l,c;return e&&s.sortDataByOpts(a,e),i=r(a,e),c=function(o){if(s.options.wrapWith){var r=t(s.options.wrapWith);r.append(o),o=r}return o},l=function(){var c=r(a,e);o(s,a,c),n(s,a,e,c,l),t(i).replaceWith(c),i=c},o(s,a,i),n(s,a,e,i,l),c(i)}},window.NRecoPivotTableExtensions.prototype.wrapPivotExportRenderer=function(o){return function(r,s){var n=o(r,s);return t(n).addClass("pivotExportData").data("getPivotExportData",function(){return a(r)}),n}},window.NRecoPivotTableExtensions.defaults={drillDownHandler:null,wrapWith:null}}).call(this);